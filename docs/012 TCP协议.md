### 什么是tcp四层模型

**TCP/IP四层模型**

| TCP/IP结构     | 协议实现                                                     | 设备               |
| -------------- | ------------------------------------------------------------ | ------------------ |
| 应用层         | 服务：DNS, DHCP <br/>协议:   TELNET, SSH, SMTP, POP, FTP, HTTP |                    |
| 传输层         | TCP, UDP, SCTP, DCCP                                         |                    |
| 网络层         | IP (IPV4和IPV6), ARP, ,ICMP, IPsec                           | 路由器，三层交换机 |
| 物理数据链路层 |                                                              |                    |



---



### TCP 与 UDP 的区别

- `UDP `用户数据报协议 ：
  - 无连接的
  - 不保证可靠交付，尽最大努力交付
  - 不保证报文顺序
  - 具有较好的实时性，效率高
- `TCP`传输控制协议 ：
  - 面向连接的。
  - 提供可靠交付。
  - TCP保证数据顺序 
  - 有流量控制，拥塞控制，提供全双工通信。



### TCP三次握手，四次挥手的原理

**TCP 的三次握手**

流程

![./images/tcp1.png](tcp1.png)

服务器：处于 LISTEN（监听）状态，等待客户的连接请求。 

客户端（第一次握手）：请求建立连接，发送报文：SYN=1，seq=n 。

服务端（第二次握手）：确认建立连接，发送报文：SYN=1，ACK=1 ， seq=y，ack=x+1 。

客户端（第三次握手）：确认回复，发送报文：ACK=1，seq=x+1，ack=y+1

服务器：收到确认回复，建立连接。

**为什么要三次握手：**

防止客户端失效的连接报文发送到服务器，然后建立无用的连接, 因此需要进行一次来回确认, 这样总共有三次请求。

> 假设只有两次握手：客户端请求连接，由于网络延时导致报文请求重新发送，由于没有客户端第三次确认，则服务器直接建立这2次连接，导致浪费了连接资源。





**TCP的四次挥手**

![images/tcp2.png](tcp2.png)

客户端：数据传输完成。

客户端：请求释放连接，发送报文：FIN=1，seq=u

服务器：确认释放连接，半关闭通道。发送报文：ACK=1，seq=v，ack=u+1

服务器：数据传输完成。

服务器：请求释放连接：发送报文：FIN=1，ACK=1，seq=w，ack=u+1

客户端：确认释放连接，发送报文：ACK=1，seq=u+1，ack=w+1



**为什么需要四次挥手：**

由于TCP协议是全双工通信，双向通道传输，客户端数据发送完成，服务器数据没有完全发送完成。此时通道半关闭当服务器数据发送完成后，服务器在发送确认请求，才完全关闭连接。







### 什么是TCP滑动窗口

#### 1. 滑动窗口

![tcp3.jpg](tcp3.jpg)
![tcp4.jpg](tcp4.jpg)



#### 2. 滑动窗口差错恢复

1. 回退N步
2. 选择重传





### 描述下常用端口以及对应的服务

服务端口

| 服务    | 端口 | 说明 |
| ------- | ---- | ---- |
| FTP     | 21   |      |
| SSH     | 22   |      |
| TELNET  | 23   |      |
| DNS     | 53   |      |
| HTTP    | 80   |      |
| SFTP    | 115  |      |
| HTTPS   | 443  |      |
| SOCKETS | 1080 |      |

应用端口

| 服务   | 端口 | 说明 |
| ------ | ---- | ---- |
| oracle | 1521 |      |
| mysql  | 3306 |      |
| redis  | 6379 |      |
| tomcat | 8080 |      |



